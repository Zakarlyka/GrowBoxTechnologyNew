# üå± AGRO HOGWARDS - –ü–û–í–ù–ò–ô –ú–ê–ô–°–¢–ï–†-–ü–†–û–ú–ü–¢ –î–õ–Ø –í–Ü–î–¢–í–û–†–ï–ù–ù–Ø –ü–†–û–ï–ö–¢–£

**–í–µ—Ä—Å—ñ—è:** 5.0 ULTIMATE  
**–î–∞—Ç–∞:** 2025-11-19  
**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è:** –ü–æ–≤–Ω–µ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è IoT –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ –∑ –Ω—É–ª—è

---

## üìã –ó–ú–Ü–°–¢

1. [–ó–∞–≥–∞–ª—å–Ω–∏–π –û–ø–∏—Å](#–∑–∞–≥–∞–ª—å–Ω–∏–π-–æ–ø–∏—Å)
2. [–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—á–Ω–∏–π –°—Ç–µ–∫](#—Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—á–Ω–∏–π-—Å—Ç–µ–∫)
3. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç—É](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç—É)
4. [–ë–∞–∑–∞ –î–∞–Ω–∏—Ö Supabase](#–±–∞–∑–∞-–¥–∞–Ω–∏—Ö-supabase)
5. [Row Level Security (RLS)](#row-level-security-rls)
6. [Database Functions](#database-functions)
7. [Database Triggers](#database-triggers)
8. [Edge Functions](#edge-functions)
9. [Frontend –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞](#frontend-–∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞)
10. [–ö–ª—é—á–æ–≤—ñ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏](#–∫–ª—é—á–æ–≤—ñ-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏)
11. [Hooks —Ç–∞ –£—Ç–∏–ª—ñ—Ç–∏](#hooks-—Ç–∞-—É—Ç–∏–ª—ñ—Ç–∏)
12. [–î–∏–∑–∞–π–Ω –°–∏—Å—Ç–µ–º–∞](#–¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞)
13. [IoT –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è](#iot-—ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è)
14. [–†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è](#—Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è)

---

## üéØ –ó–ê–ì–ê–õ–¨–ù–ò–ô –û–ü–ò–°

**Agro Hogwards** - —Ü–µ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∞ IoT –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è grow box —Å–∏—Å—Ç–µ–º–∞–º–∏ (–±–æ–∫—Å–∞–º–∏ –¥–ª—è –≤–∏—Ä–æ—â—É–≤–∞–Ω–Ω—è —Ä–æ—Å–ª–∏–Ω) –∑ –º–æ–∂–ª–∏–≤–æ—Å—Ç—è–º–∏:

- üìä **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Å–µ–Ω—Å–æ—Ä—ñ–≤**: —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –≤–æ–ª–æ–≥—ñ—Å—Ç—å, –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è, pH, EC, CO2, –≤–æ–ª–æ–≥—ñ—Å—Ç—å “ë—Ä—É–Ω—Ç—É
- üéÆ **–î–∏—Å—Ç–∞–Ω—Ü—ñ–π–Ω–µ –∫–µ—Ä—É–≤–∞–Ω–Ω—è**: –ª–∞–º–ø–∏, –≤–æ–¥—è–Ω—ñ –ø–æ–º–ø–∏, –≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—è, –æ–±—ñ–≥—Ä—ñ–≤–∞—á—ñ
- üìà **–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞**: –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ –∑ –≥—Ä–∞—Ñ—ñ–∫–∞–º–∏
- ‚è∞ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è**: —Ä–æ–∑–∫–ª–∞–¥–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏
- üìö **–ë–∞–∑–∞ –∑–Ω–∞–Ω—å**: —Å—Ç–∞—Ç—Ç—ñ –ø—Ä–æ –≤–∏—Ä–æ—â—É–≤–∞–Ω–Ω—è, –∫–∞—Ç–∞–ª–æ–≥ —Å–æ—Ä—Ç—ñ–≤ —Ä–æ—Å–ª–∏–Ω
- üë• **–ú—É–ª—å—Ç–∏—Ä–æ–ª—å**: 4 —Ä–æ–ª—ñ (user, developer, admin, superadmin)
- üåê **–ë–∞–≥–∞—Ç–æ–º–æ–≤–Ω—ñ—Å—Ç—å**: —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞, —Ä–æ—Å—ñ–π—Å—å–∫–∞, –∞–Ω–≥–ª—ñ–π—Å—å–∫–∞
- üîê **–ë–µ–∑–ø–µ–∫–∞**: RLS –Ω–∞ —Ä—ñ–≤–Ω—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, OAuth –ø—ñ–¥—Ç—Ä–∏–º–∫–∞

---

## üõ† –¢–ï–•–ù–û–õ–û–ì–Ü–ß–ù–ò–ô –°–¢–ï–ö

### Frontend
- **Framework**: React 18.3.1 + TypeScript
- **Build Tool**: Vite 5.0.3
- **Routing**: React Router DOM 6.30.1
- **Styling**: Tailwind CSS 3.x –∑ HSL –∑–º—ñ–Ω–Ω–∏–º–∏
- **State Management**: TanStack React Query 5.83.0
- **UI Components**: Shadcn/UI (Radix UI primitives)
- **Charts**: Recharts 3.2.1
- **i18n**: react-i18next 15.7.3
- **Icons**: Lucide React 0.462.0
- **Forms**: React Hook Form 7.61.1 + Zod 3.25.76

### Backend
- **Database**: Supabase (PostgreSQL 15+)
- **Auth**: Supabase Auth (Email + OAuth)
- **API**: Supabase Client (@supabase/supabase-js 2.80.0)
- **Serverless**: Supabase Edge Functions (Deno runtime)
- **Real-time**: Supabase Realtime (WebSockets)

### Security
- **RLS**: Row Level Security –Ω–∞ –≤—Å—ñ—Ö —Ç–∞–±–ª–∏—Ü—è—Ö
- **Functions**: SECURITY DEFINER –¥–ª—è –∞–¥–º—ñ–Ω-—Ñ—É–Ω–∫—Ü—ñ–π
- **Auth**: JWT —Ç–æ–∫–µ–Ω–∏, refresh tokens

---

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–£

```
agro-hogwards/
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îú‚îÄ‚îÄ _redirects                          # Netlify redirects
‚îÇ   ‚îú‚îÄ‚îÄ favicon.png
‚îÇ   ‚îú‚îÄ‚îÄ icons/icon-512x512.png
‚îÇ   ‚îú‚îÄ‚îÄ manifest.json                       # PWA manifest
‚îÇ   ‚îú‚îÄ‚îÄ robots.txt
‚îÇ   ‚îú‚îÄ‚îÄ sitemap.xml
‚îÇ   ‚îî‚îÄ‚îÄ esp8266-setup-example.html
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logo-agro-hogwards.png
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logo-agro-hogwards-new.png
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/                             # 40+ Shadcn –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ button.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ card.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dialog.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ input.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ select.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ table.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ... (–≤—Å—ñ Shadcn –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏)
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin/                          # –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UserManager.tsx             # –ö–µ—Ä—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ArticleManager.tsx          # –ö–µ—Ä—É–≤–∞–Ω–Ω—è —Å—Ç–∞—Ç—Ç—è–º–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ArticleForm.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StrainManager.tsx           # –ö–µ—Ä—É–≤–∞–Ω–Ω—è —Å–æ—Ä—Ç–∞–º–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ StrainForm.tsx
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AddDeviceDialog.tsx             # –î—ñ–∞–ª–æ–≥ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—é
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdminPanel.tsx                  # –ì–æ–ª–æ–≤–Ω–∞ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdvancedCharts.tsx              # –†–æ–∑—à–∏—Ä–µ–Ω—ñ –≥—Ä–∞—Ñ—ñ–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthForm.tsx                    # –§–æ—Ä–º–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.tsx                   # –ì–æ–ª–æ–≤–Ω–∞ –ø–∞–Ω–µ–ª—å (dashboard)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DeveloperCabinet.tsx            # –ö–∞–±—ñ–Ω–µ—Ç —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DeviceCard.tsx                  # –ö–∞—Ä—Ç–∫–∞ –ø—Ä–∏—Å—Ç—Ä–æ—é
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DeviceControls.tsx              # –ï–ª–µ–º–µ–Ω—Ç–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DeviceGroups.tsx                # –ì—Ä—É–ø–∏ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DeviceManagement.tsx            # –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DeviceSchedules.tsx             # –†–æ–∑–∫–ª–∞–¥–∏ –¥–ª—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DeviceSettings.tsx              # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Devices.tsx                     # –°–ø–∏—Å–æ–∫ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Header.tsx                      # –®–∞–ø–∫–∞ —Å–∞–π—Ç—É
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Layout.tsx                      # –ì–æ–ª–æ–≤–Ω–∏–π layout
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LogsTable.tsx                   # –¢–∞–±–ª–∏—Ü—è –ª–æ–≥—ñ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Navigation.tsx                  # –ù–∞–≤—ñ–≥–∞—Ü—ñ—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotificationSettings.tsx        # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–ø–æ–≤—ñ—â–µ–Ω—å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ QRDeviceSetup.tsx               # QR-–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RemoteControl.tsx               # –î–∏—Å—Ç–∞–Ω—Ü—ñ–π–Ω–µ –∫–µ—Ä—É–≤–∞–Ω–Ω—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SensorChart.tsx                 # –ì—Ä–∞—Ñ—ñ–∫ —Å–µ–Ω—Å–æ—Ä—ñ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Terminal.tsx                    # –¢–µ—Ä–º—ñ–Ω–∞–ª –¥–ª—è ESP
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UserCabinet.tsx                 # –ö–∞–±—ñ–Ω–µ—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Account.tsx                     # –°—Ç–æ—Ä—ñ–Ω–∫–∞ –∞–∫–∞—É–Ω—Ç—É
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AddDevice.tsx                   # –°—Ç–æ—Ä—ñ–Ω–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—é
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdminPage.tsx                   # –°—Ç–æ—Ä—ñ–Ω–∫–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AnalyticsPage.tsx               # –°—Ç–æ—Ä—ñ–Ω–∫–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ArticleDetailPage.tsx           # –î–µ—Ç–∞–ª—å–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ —Å—Ç–∞—Ç—Ç—ñ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Auth.tsx                        # –°—Ç–æ—Ä—ñ–Ω–∫–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DashboardPage.tsx               # –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ dashboard
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DeveloperPage.tsx               # –°—Ç–æ—Ä—ñ–Ω–∫–∞ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DeviceDetail.tsx                # –î–µ—Ç–∞–ª—ñ –ø—Ä–∏—Å—Ç—Ä–æ—é
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Devices.tsx                     # –°—Ç–æ—Ä—ñ–Ω–∫–∞ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DevicesPage.tsx                 # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Index.tsx                       # –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ (landing)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LibraryPage.tsx                 # –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –∑–Ω–∞–Ω—å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotFound.tsx                    # 404 —Å—Ç–æ—Ä—ñ–Ω–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ QRConnection.tsx                # –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —á–µ—Ä–µ–∑ QR
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RemoteControlPage.tsx           # –°—Ç–æ—Ä—ñ–Ω–∫–∞ –¥–∏—Å—Ç. –∫–µ—Ä—É–≤–∞–Ω–Ω—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Settings.tsx                    # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-mobile.tsx                  # –î–µ—Ç–µ–∫—Ç–æ—Ä –º–æ–±—ñ–ª—å–Ω–æ–≥–æ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-toast.ts                    # Toast –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useAuth.tsx                     # ‚≠ê –ö–†–ò–¢–ò–ß–ù–ò–ô —Ö—É–∫ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useDeviceControls.tsx           # –•—É–∫ –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useDeviceLogs.tsx               # –•—É–∫ –¥–ª—è –ª–æ–≥—ñ–≤ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useDeviceSchedules.tsx          # –•—É–∫ –¥–ª—è —Ä–æ–∑–∫–ª–∞–¥—ñ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useDevices.tsx                  # –•—É–∫ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useLibrary.ts                   # –•—É–∫ –¥–ª—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useSensorData.tsx               # –•—É–∫ –¥–ª—è –¥–∞–Ω–∏—Ö —Å–µ–Ω—Å–æ—Ä—ñ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useUserRole.tsx                 # ‚≠ê –•—É–∫ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ä–æ–ª–µ–π
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ integrations/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ supabase/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ client.ts                   # ‚≠ê –ö–ª—ñ—î–Ω—Ç Supabase
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ types.ts                    # AUTO-GENERATED (–Ω–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts                        # –ó–∞–≥–∞–ª—å–Ω—ñ —Ç–∏–ø–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ supabase-v2.8.ts                # ‚≠ê –†—É—á–Ω—ñ override —Ç–∏–ø–∏
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils.ts                        # –£—Ç–∏–ª—ñ—Ç–∏ (cn, —Ç–æ—â–æ)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validations.ts                  # –°—Ö–µ–º–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó Zod
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ i18n/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts                        # –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è i18n
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ locales/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ en.json                     # –ê–Ω–≥–ª—ñ–π—Å—å–∫–∞
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ uk.json                     # –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ru.json                     # –†–æ—Å—ñ–π—Å—å–∫–∞
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ App.tsx                             # –ì–æ–ª–æ–≤–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ App.css                             # –ì–ª–æ–±–∞–ª—å–Ω—ñ —Å—Ç–∏–ª—ñ
‚îÇ   ‚îú‚îÄ‚îÄ main.tsx                            # Entry point
‚îÇ   ‚îú‚îÄ‚îÄ index.css                           # ‚≠ê Tailwind + Semantic tokens
‚îÇ   ‚îî‚îÄ‚îÄ vite-env.d.ts                       # Vite type declarations
‚îÇ
‚îú‚îÄ‚îÄ supabase/
‚îÇ   ‚îú‚îÄ‚îÄ config.toml                         # ‚≠ê –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Supabase
‚îÇ   ‚îî‚îÄ‚îÄ functions/                          # Edge Functions
‚îÇ       ‚îú‚îÄ‚îÄ device-api/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ index.ts                    # API –¥–ª—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ (ESP)
‚îÇ       ‚îú‚îÄ‚îÄ generate-qr/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ index.ts                    # –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è QR –∫–æ–¥—ñ–≤
‚îÇ       ‚îú‚îÄ‚îÄ notification-system/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ index.ts                    # –°–∏—Å—Ç–µ–º–∞ —Å–ø–æ–≤—ñ—â–µ–Ω—å
‚îÇ       ‚îú‚îÄ‚îÄ setup/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ index.ts                    # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏
‚îÇ       ‚îî‚îÄ‚îÄ confirm-device/
‚îÇ           ‚îú‚îÄ‚îÄ index.ts                    # –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
‚îÇ           ‚îú‚îÄ‚îÄ README.md
‚îÇ           ‚îî‚îÄ‚îÄ LICENSE
‚îÇ
‚îú‚îÄ‚îÄ nginx/
‚îÇ   ‚îî‚îÄ‚îÄ default.conf                        # Nginx –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îÇ
‚îú‚îÄ‚îÄ .env                                     # Environment –∑–º—ñ–Ω–Ω—ñ
‚îú‚îÄ‚îÄ docker-compose.yml                       # Docker Compose
‚îú‚îÄ‚îÄ Dockerfile.frontend                      # Dockerfile
‚îú‚îÄ‚îÄ netlify.toml                            # Netlify –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ vercel.json                             # Vercel –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ tailwind.config.ts                      # ‚≠ê Tailwind –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ vite.config.ts                          # Vite –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ tsconfig.json                           # TypeScript –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ package.json                            # Dependencies
‚îú‚îÄ‚îÄ index.html                              # HTML entry point
‚îÇ
‚îî‚îÄ‚îÄ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è/
    ‚îú‚îÄ‚îÄ README.md                           # –û—Å–Ω–æ–≤–Ω–∏–π README
    ‚îú‚îÄ‚îÄ DEPLOYMENT.md                       # –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –∑ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è
    ‚îú‚îÄ‚îÄ DEPLOYMENT_GUIDE.md                 # –†–æ–∑—à–∏—Ä–µ–Ω–∏–π –≥–∞–π–¥
    ‚îú‚îÄ‚îÄ ESP8266_INTEGRATION.md              # –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è ESP8266
    ‚îî‚îÄ‚îÄ deployment-guide.md                 # –î–µ—Ç–∞–ª—å–Ω–∏–π –≥–∞–π–¥
```

---

## üíæ –ë–ê–ó–ê –î–ê–ù–ò–• SUPABASE

### üîê ENUM –¢–∏–ø–∏

```sql
-- –†–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
CREATE TYPE public.app_role AS ENUM (
    'user',
    'developer',
    'admin',
    'superadmin'
);

-- –û–¥–∏–Ω–∏—Ü—ñ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è
CREATE TYPE public.preferred_units AS ENUM (
    'metric',
    'imperial'
);
```

### üìä –¢–ê–ë–õ–ò–¶–Ü (–ü–æ–≤–Ω–∞ –°—Ö–µ–º–∞)

#### 1. **profiles** - –ü—Ä–æ—Ñ—ñ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

```sql
CREATE TABLE public.profiles (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL UNIQUE REFERENCES auth.users(id) ON DELETE CASCADE,
    email TEXT NOT NULL,
    full_name TEXT,
    avatar_url TEXT,
    phone TEXT,
    category TEXT DEFAULT 'standard',
    developer_id UUID REFERENCES public.profiles(id),
    units preferred_units NOT NULL DEFAULT 'metric',
    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- –Ü–Ω–¥–µ–∫—Å–∏
CREATE INDEX idx_profiles_user_id ON public.profiles(user_id);
CREATE INDEX idx_profiles_developer_id ON public.profiles(developer_id);

-- –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ
COMMENT ON TABLE public.profiles IS '–ü—Ä–æ—Ñ—ñ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ –¥–æ–¥–∞—Ç–∫–æ–≤–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é';
COMMENT ON COLUMN public.profiles.developer_id IS '–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞ (–¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó developer)';
COMMENT ON COLUMN public.profiles.category IS '–ö–∞—Ç–µ–≥–æ—Ä—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: standard, premium, enterprise';
```

#### 2. **user_roles** - –†–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

```sql
CREATE TABLE public.user_roles (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    app_role app_role DEFAULT 'user'::app_role,
    created_at TIMESTAMPTZ DEFAULT now(),
    UNIQUE(user_id)  -- –û–¥–∏–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á = –æ–¥–Ω–∞ —Ä–æ–ª—å
);

-- –Ü–Ω–¥–µ–∫—Å–∏
CREATE INDEX idx_user_roles_user_id ON public.user_roles(user_id);
CREATE INDEX idx_user_roles_app_role ON public.user_roles(app_role);

COMMENT ON TABLE public.user_roles IS '‚≠ê –ö–†–ò–¢–ò–ß–ù–ê —Ç–∞–±–ª–∏—Ü—è: —Ä–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é –¥–æ—Å—Ç—É–ø—É';
COMMENT ON COLUMN public.user_roles.app_role IS '–†–æ–ª—å: user, developer, admin, superadmin';
```

#### 3. **devices** - –ü—Ä–∏—Å—Ç—Ä–æ—ó IoT

```sql
CREATE TABLE public.devices (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
    device_id TEXT NOT NULL UNIQUE,  -- –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID –ø—Ä–∏—Å—Ç—Ä–æ—é (ESP MAC)
    name TEXT NOT NULL DEFAULT 'Unnamed Device',
    type TEXT NOT NULL DEFAULT 'grow_box',
    location TEXT,
    status TEXT NOT NULL DEFAULT 'offline',  -- online, offline, error
    settings JSONB DEFAULT '{}',
    group_id UUID REFERENCES public.device_groups(id) ON DELETE SET NULL,
    last_temp DOUBLE PRECISION,
    last_hum DOUBLE PRECISION,
    last_activity TIMESTAMPTZ,
    last_seen TIMESTAMPTZ DEFAULT now(),
    last_seen_at TIMESTAMPTZ DEFAULT now(),
    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- –Ü–Ω–¥–µ–∫—Å–∏
CREATE INDEX idx_devices_user_id ON public.devices(user_id);
CREATE INDEX idx_devices_device_id ON public.devices(device_id);
CREATE INDEX idx_devices_status ON public.devices(status);
CREATE INDEX idx_devices_group_id ON public.devices(group_id);

COMMENT ON TABLE public.devices IS 'IoT –ø—Ä–∏—Å—Ç—Ä–æ—ó (grow boxes, ESP8266/ESP32)';
COMMENT ON COLUMN public.devices.settings IS 'JSONB –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è: target_temp, target_hum, schedules, etc.';
COMMENT ON COLUMN public.devices.last_seen_at IS '–û—Å—Ç–∞–Ω–Ω—ñ–π —Ä–∞–∑ –∫–æ–ª–∏ –ø—Ä–∏—Å—Ç—Ä—ñ–π –Ω–∞–¥—ñ—Å–ª–∞–≤ –¥–∞–Ω—ñ';
```

#### 4. **device_controls** - –ö–µ—Ä—É–≤–∞–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏

```sql
CREATE TABLE public.device_controls (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    device_id UUID NOT NULL REFERENCES public.devices(id) ON DELETE CASCADE,
    user_id UUID,
    control_name TEXT NOT NULL,  -- water_pump, light_system, ventilation, heater
    control_type TEXT NOT NULL,  -- switch, slider, toggle
    value BOOLEAN DEFAULT false,
    intensity INTEGER DEFAULT 0,  -- ‚≠ê –î–ª—è –¥–∏–º–º—É–≤–∞–Ω–Ω—è (0-100)
    schedule JSONB DEFAULT '{}',
    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    UNIQUE(device_id, control_name)
);

-- –Ü–Ω–¥–µ–∫—Å–∏
CREATE INDEX idx_device_controls_device_id ON public.device_controls(device_id);
CREATE INDEX idx_device_controls_user_id ON public.device_controls(user_id);

COMMENT ON TABLE public.device_controls IS '–°—Ç–∞–Ω –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏';
COMMENT ON COLUMN public.device_controls.intensity IS '–Ü–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ñ—Å—Ç—å 0-100 (–¥–ª—è –¥–∏–º–º—É–≤–∞–Ω–Ω—è —Å–≤—ñ—Ç–ª–∞, —à–≤–∏–¥–∫–æ—Å—Ç—ñ –≤–µ–Ω—Ç–∏–ª—è—Ü—ñ—ó)';
```

#### 5. **device_logs** - –õ–æ–≥–∏ —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—ó

```sql
CREATE TABLE public.device_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    device_id TEXT NOT NULL,  -- TEXT –¥–ª—è –∑–≤–æ—Ä–æ—Ç–Ω–æ—ó —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ
    device_id_uuid UUID REFERENCES public.devices(id) ON DELETE CASCADE,
    user_id UUID,
    metric TEXT DEFAULT 'env',  -- temperature, humidity, env (environmental)
    temp DOUBLE PRECISION,
    hum DOUBLE PRECISION,
    soil_moisture DOUBLE PRECISION,
    light_level DOUBLE PRECISION,
    light_cycle_hours INTEGER,
    irrigation_time TIME,
    value NUMERIC,  -- –ó–∞–≥–∞–ª—å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è
    created_at TIMESTAMPTZ DEFAULT now()
);

-- –Ü–Ω–¥–µ–∫—Å–∏
CREATE INDEX idx_device_logs_device_id ON public.device_logs(device_id);
CREATE INDEX idx_device_logs_device_id_uuid ON public.device_logs(device_id_uuid);
CREATE INDEX idx_device_logs_created_at ON public.device_logs(created_at DESC);
CREATE INDEX idx_device_logs_metric ON public.device_logs(metric);

COMMENT ON TABLE public.device_logs IS '–¢–µ–ª–µ–º–µ—Ç—Ä—ñ—è –≤—ñ–¥ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ (time-series data)';
COMMENT ON COLUMN public.device_logs.device_id_uuid IS 'UUID reference –¥–ª—è –Ω–æ–≤–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤';
```

#### 6. **sensor_data** - –î–∞–Ω—ñ —Å–µ–Ω—Å–æ—Ä—ñ–≤ (—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ)

```sql
CREATE TABLE public.sensor_data (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    device_id UUID NOT NULL REFERENCES public.devices(id) ON DELETE CASCADE,
    temperature NUMERIC,
    humidity NUMERIC,
    soil_moisture NUMERIC,
    light_level NUMERIC,
    ph_level NUMERIC,
    ec_level NUMERIC,
    water_level NUMERIC,
    timestamp TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- –Ü–Ω–¥–µ–∫—Å–∏
CREATE INDEX idx_sensor_data_device_id ON public.sensor_data(device_id);
CREATE INDEX idx_sensor_data_timestamp ON public.sensor_data(timestamp DESC);

COMMENT ON TABLE public.sensor_data IS '–°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ —Å–µ–Ω—Å–æ—Ä—ñ–≤ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ device_logs)';
```

#### 7. **device_schedules** - –†–æ–∑–∫–ª–∞–¥–∏ –¥–ª—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤

```sql
CREATE TABLE public.device_schedules (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    device_id UUID NOT NULL REFERENCES public.devices(id) ON DELETE CASCADE,
    control_name TEXT NOT NULL,  -- water_pump, light_system
    schedule_type TEXT NOT NULL,  -- time_range, interval, daily
    start_time TIME,
    end_time TIME,
    interval_minutes INTEGER,
    days_of_week INTEGER[],  -- [0,1,2,3,4,5,6] –¥–ª—è Mon-Sun
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);

-- –Ü–Ω–¥–µ–∫—Å–∏
CREATE INDEX idx_device_schedules_device_id ON public.device_schedules(device_id);
CREATE INDEX idx_device_schedules_is_active ON public.device_schedules(is_active);

COMMENT ON TABLE public.device_schedules IS '–†–æ–∑–∫–ª–∞–¥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó –¥–ª—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤';
```

#### 8. **schedules** - –ó–∞–≥–∞–ª—å–Ω—ñ —Ä–æ–∑–∫–ª–∞–¥–∏ (legacy)

```sql
CREATE TABLE public.schedules (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    device_id UUID NOT NULL REFERENCES public.devices(id) ON DELETE CASCADE,
    name TEXT NOT NULL,
    action TEXT NOT NULL,
    start_time TIME NOT NULL,
    end_time TIME,
    repeat TEXT NOT NULL DEFAULT 'daily',
    days_of_week INTEGER[] DEFAULT ARRAY[0,1,2,3,4,5,6],
    enabled BOOLEAN DEFAULT true,
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);

CREATE INDEX idx_schedules_device_id ON public.schedules(device_id);
```

#### 9. **device_groups** - –ì—Ä—É–ø–∏ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤

```sql
CREATE TABLE public.device_groups (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL,
    name TEXT NOT NULL,
    description TEXT,
    color TEXT DEFAULT '#4F46E5',
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);

CREATE INDEX idx_device_groups_user_id ON public.device_groups(user_id);

COMMENT ON TABLE public.device_groups IS '–ì—Ä—É–ø–∏ –¥–ª—è –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤';
```

#### 10. **device_group_members** - –ó–≤'—è–∑–æ–∫ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ —Ç–∞ –≥—Ä—É–ø

```sql
CREATE TABLE public.device_group_members (
    group_id UUID NOT NULL REFERENCES public.device_groups(id) ON DELETE CASCADE,
    device_id UUID NOT NULL REFERENCES public.devices(id) ON DELETE CASCADE,
    added_at TIMESTAMPTZ DEFAULT now(),
    PRIMARY KEY (group_id, device_id)
);

CREATE INDEX idx_dgm_group_id ON public.device_group_members(group_id);
CREATE INDEX idx_dgm_device_id ON public.device_group_members(device_id);
```

#### 11. **strains** - –ö–∞—Ç–∞–ª–æ–≥ —Å–æ—Ä—Ç—ñ–≤ —Ä–æ—Å–ª–∏–Ω

```sql
CREATE TABLE public.strains (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name TEXT NOT NULL,
    type TEXT NOT NULL DEFAULT 'photoperiod',  -- photoperiod, autoflower
    description TEXT,
    settings_by_phase JSONB,  -- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ —Ñ–∞–∑–∞–º —Ä–æ—Å—Ç—É
    fertilizer_schedule JSONB,  -- –ì—Ä–∞—Ñ—ñ–∫ –≤–Ω–µ—Å–µ–Ω–Ω—è –¥–æ–±—Ä–∏–≤
    created_at TIMESTAMPTZ DEFAULT now()
);

CREATE INDEX idx_strains_type ON public.strains(type);

COMMENT ON TABLE public.strains IS '–ü—É–±–ª—ñ—á–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥ —Å–æ—Ä—Ç—ñ–≤ —Ä–æ—Å–ª–∏–Ω';
```

#### 12. **custom_strains** - –ö–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫—ñ —Å–æ—Ä—Ç–∏

```sql
CREATE TABLE public.custom_strains (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL,
    name TEXT NOT NULL,
    type TEXT,
    notes TEXT,
    start_date DATE,
    created_at TIMESTAMPTZ DEFAULT now()
);

CREATE INDEX idx_custom_strains_user_id ON public.custom_strains(user_id);
```

#### 13. **articles** - –°—Ç–∞—Ç—Ç—ñ –±–∞–∑–∏ –∑–Ω–∞–Ω—å

```sql
CREATE TABLE public.articles (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    title TEXT NOT NULL,
    content TEXT,
    category TEXT,
    created_at TIMESTAMPTZ DEFAULT now()
);

CREATE INDEX idx_articles_category ON public.articles(category);

COMMENT ON TABLE public.articles IS '–ë–∞–∑–∞ –∑–Ω–∞–Ω—å: —Å—Ç–∞—Ç—Ç—ñ –ø—Ä–æ –≤–∏—Ä–æ—â—É–≤–∞–Ω–Ω—è';
```

#### 14. **notifications** - –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–ø–æ–≤—ñ—â–µ–Ω—å

```sql
CREATE TABLE public.notifications (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL,
    device_id UUID REFERENCES public.devices(id) ON DELETE CASCADE,
    type TEXT NOT NULL,  -- temperature, humidity, offline
    config JSONB DEFAULT '{}',
    enabled BOOLEAN DEFAULT true,
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);

CREATE INDEX idx_notifications_user_id ON public.notifications(user_id);
CREATE INDEX idx_notifications_device_id ON public.notifications(device_id);
```

#### 15. **notification_settings** - –ì–ª–æ–±–∞–ª—å–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–ø–æ–≤—ñ—â–µ–Ω—å

```sql
CREATE TABLE public.notification_settings (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL,
    email_enabled BOOLEAN DEFAULT true,
    push_enabled BOOLEAN DEFAULT false,
    temperature_min NUMERIC,
    temperature_max NUMERIC,
    humidity_min NUMERIC,
    humidity_max NUMERIC,
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);

CREATE INDEX idx_notification_settings_user_id ON public.notification_settings(user_id);
```

#### 16. **pending_devices** - –¢–∏–º—á–∞—Å–æ–≤—ñ —Ç–æ–∫–µ–Ω–∏ –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤

```sql
CREATE TABLE public.pending_devices (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    device_token TEXT NOT NULL UNIQUE,
    user_id UUID,
    expires_at TIMESTAMPTZ NOT NULL,
    created_at TIMESTAMPTZ DEFAULT now()
);

CREATE INDEX idx_pending_devices_device_token ON public.pending_devices(device_token);
CREATE INDEX idx_pending_devices_expires_at ON public.pending_devices(expires_at);

COMMENT ON TABLE public.pending_devices IS '–¢–∏–º—á–∞—Å–æ–≤—ñ —Ç–æ–∫–µ–Ω–∏ –¥–ª—è QR-–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤';
```

#### 17. **device_pairing_temp** - –¢–∏–º—á–∞—Å–æ–≤—ñ –∫–æ–¥–∏ —Å–ø–∞—Ä—é–≤–∞–Ω–Ω—è

```sql
CREATE TABLE public.device_pairing_temp (
    device_id TEXT NOT NULL PRIMARY KEY,
    pairing_code TEXT NOT NULL,
    user_id UUID,
    created_at TIMESTAMPTZ DEFAULT now()
);

CREATE INDEX idx_dpt_pairing_code ON public.device_pairing_temp(pairing_code);

COMMENT ON TABLE public.device_pairing_temp IS '–¢–∏–º—á–∞—Å–æ–≤—ñ –∫–æ–¥–∏ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Å–ø–∞—Ä—é–≤–∞–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤';
```

---

## üîí ROW LEVEL SECURITY (RLS)

### –ó–∞–≥–∞–ª—å–Ω—ñ –ü—Ä–∏–Ω—Ü–∏–ø–∏

1. **RLS —É–≤—ñ–º–∫–Ω–µ–Ω–æ –Ω–∞ –í–°–Ü–• —Ç–∞–±–ª–∏—Ü—è—Ö**
2. **–ü–æ–ª—ñ—Ç–∏–∫–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —Ñ—É–Ω–∫—Ü—ñ—é `is_admin()` –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–∞–≤**
3. **Superadmin –º–∞—î –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ is_admin()**
4. **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –±–∞—á–∞—Ç—å —Ç—ñ–ª—å–∫–∏ —Å–≤–æ—ó –¥–∞–Ω—ñ —á–µ—Ä–µ–∑ `auth.uid() = user_id`**

### RLS Policies –ø–æ —Ç–∞–±–ª–∏—Ü—è—Ö

#### 1. **profiles**

```sql
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;

-- Admins —Ç–∞ Superadmins –∫–µ—Ä—É—é—Ç—å –≤—Å—ñ–º–∞, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ - —Ç—ñ–ª—å–∫–∏ —Å–≤–æ—ó–º –ø—Ä–æ—Ñ—ñ–ª–µ–º
CREATE POLICY "Admins manage all, Users manage their own"
ON public.profiles
FOR ALL
USING (is_admin() OR auth.uid() = user_id)
WITH CHECK (is_admin() OR auth.uid() = user_id);
```

#### 2. **user_roles** ‚≠ê –ö–†–ò–¢–ò–ß–ù–ê

```sql
ALTER TABLE public.user_roles ENABLE ROW LEVEL SECURITY;

-- SELECT: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å —Å–≤–æ—é —Ä–æ–ª—å –ê–ë–û —Å–∏—Å—Ç–µ–º–∞ postgres (–¥–ª—è –æ–±—Ö–æ–¥—É —Ä–µ–∫—É—Ä—Å—ñ—ó)
CREATE POLICY "Allow_SELECT_for_self_or_system"
ON public.user_roles
FOR SELECT
USING (auth.uid() = user_id OR SESSION_USER = 'postgres');

-- INSERT/UPDATE/DELETE: –¢—ñ–ª—å–∫–∏ –∞–¥–º—ñ–Ω–∏
CREATE POLICY "Allow_INSERT_for_admins"
ON public.user_roles
FOR INSERT
WITH CHECK (is_admin());

CREATE POLICY "Allow_UPDATE_for_admins"
ON public.user_roles
FOR UPDATE
USING (is_admin())
WITH CHECK (is_admin());

CREATE POLICY "Allow_DELETE_for_admins"
ON public.user_roles
FOR DELETE
USING (is_admin());
```

**‚ö†Ô∏è –í–ê–ñ–õ–ò–í–û**: –ü–æ–ª—ñ—Ç–∏–∫–∞ SELECT –ù–ï –≤–∏–∫–ª–∏–∫–∞—î `is_admin()` –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è —Ä–µ–∫—É—Ä—Å—ñ—ó! –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `SESSION_USER = 'postgres'`.

#### 3. **devices**

```sql
ALTER TABLE public.devices ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Admins manage all, Users manage their own"
ON public.devices
FOR ALL
USING (is_admin() OR auth.uid() = user_id)
WITH CHECK (is_admin() OR auth.uid() = user_id);
```

#### 4. **device_controls**

```sql
ALTER TABLE public.device_controls ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users manage their own"
ON public.device_controls
FOR ALL
USING (auth.uid() = user_id)
WITH CHECK (auth.uid() = user_id);
```

#### 5. **device_logs**

```sql
ALTER TABLE public.device_logs ENABLE ROW LEVEL SECURITY;

-- ‚ö†Ô∏è –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –º–æ–∂—É—Ç—å –¢–Ü–õ–¨–ö–ò —á–∏—Ç–∞—Ç–∏ —Å–≤–æ—ó –ª–æ–≥–∏, –ù–ï –º–æ–∂—É—Ç—å –≤—Å—Ç–∞–≤–ª—è—Ç–∏/–∑–º—ñ–Ω—é–≤–∞—Ç–∏
-- (–í—Å—Ç–∞–≤–∫–∞ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ service role –∞–±–æ —Ç—Ä–∏–≥–µ—Ä–∏)
```

#### 6. **sensor_data**

```sql
ALTER TABLE public.sensor_data ENABLE ROW LEVEL SECURITY;

-- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –±–∞—á–∞—Ç—å –¥–∞–Ω—ñ —Ç—ñ–ª—å–∫–∏ —Å–≤–æ—ó—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
CREATE POLICY "Users can view own device sensor data only"
ON public.sensor_data
FOR SELECT
USING (
    auth.uid() IS NOT NULL 
    AND device_id IN (
        SELECT id FROM public.devices WHERE user_id = auth.uid()
    )
);

-- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –º–æ–∂—É—Ç—å –≤—Å—Ç–∞–≤–ª—è—Ç–∏ –¥–∞–Ω—ñ –¥–ª—è —Å–≤–æ—ó—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
CREATE POLICY "Users can insert sensor data for own devices"
ON public.sensor_data
FOR INSERT
WITH CHECK (
    device_id IN (
        SELECT id FROM public.devices WHERE user_id = auth.uid()
    )
);
```

#### 7. **device_schedules**

```sql
ALTER TABLE public.device_schedules ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can manage schedules for own devices"
ON public.device_schedules
FOR ALL
USING (
    device_id IN (
        SELECT id FROM public.devices WHERE user_id = auth.uid()
    )
);
```

#### 8. **schedules**

```sql
ALTER TABLE public.schedules ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view schedules for their devices"
ON public.schedules
FOR SELECT
USING (
    EXISTS (
        SELECT 1 FROM public.devices
        WHERE devices.id = schedules.device_id
        AND devices.user_id = auth.uid()
    )
);

CREATE POLICY "Users can insert schedules for their devices"
ON public.schedules
FOR INSERT
WITH CHECK (
    EXISTS (
        SELECT 1 FROM public.devices
        WHERE devices.id = schedules.device_id
        AND devices.user_id = auth.uid()
    )
);

CREATE POLICY "Users can update schedules for their devices"
ON public.schedules
FOR UPDATE
USING (
    EXISTS (
        SELECT 1 FROM public.devices
        WHERE devices.id = schedules.device_id
        AND devices.user_id = auth.uid()
    )
);

CREATE POLICY "Users can delete schedules for their devices"
ON public.schedules
FOR DELETE
USING (
    EXISTS (
        SELECT 1 FROM public.devices
        WHERE devices.id = schedules.device_id
        AND devices.user_id = auth.uid()
    )
);
```

#### 9. **device_groups**

```sql
ALTER TABLE public.device_groups ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can manage own device groups"
ON public.device_groups
FOR ALL
USING (auth.uid() = user_id);

-- –ê–±–æ –æ–∫—Ä–µ–º—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏:
CREATE POLICY "Users can view their own groups"
ON public.device_groups
FOR SELECT
USING (auth.uid() = user_id);

CREATE POLICY "Users can insert their own groups"
ON public.device_groups
FOR INSERT
WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update their own groups"
ON public.device_groups
FOR UPDATE
USING (auth.uid() = user_id);

CREATE POLICY "Users can delete their own groups"
ON public.device_groups
FOR DELETE
USING (auth.uid() = user_id);
```

#### 10. **device_group_members**

```sql
ALTER TABLE public.device_group_members ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view members of their groups"
ON public.device_group_members
FOR SELECT
USING (
    EXISTS (
        SELECT 1 FROM public.device_groups
        WHERE device_groups.id = device_group_members.group_id
        AND device_groups.user_id = auth.uid()
    )
);

CREATE POLICY "Users can add devices to their groups"
ON public.device_group_members
FOR INSERT
WITH CHECK (
    EXISTS (
        SELECT 1 FROM public.device_groups
        WHERE device_groups.id = device_group_members.group_id
        AND device_groups.user_id = auth.uid()
    )
);

CREATE POLICY "Users can remove devices from their groups"
ON public.device_group_members
FOR DELETE
USING (
    EXISTS (
        SELECT 1 FROM public.device_groups
        WHERE device_groups.id = device_group_members.group_id
        AND device_groups.user_id = auth.uid()
    )
);
```

#### 11. **strains** (–ü—É–±–ª—ñ—á–Ω–∞ —Ç–∞–±–ª–∏—Ü—è)

```sql
ALTER TABLE public.strains ENABLE ROW LEVEL SECURITY;

-- –í—Å—ñ –º–æ–∂—É—Ç—å —á–∏—Ç–∞—Ç–∏
CREATE POLICY "Public can read strains"
ON public.strains
FOR SELECT
USING (true);

-- –¢—ñ–ª—å–∫–∏ –∞–¥–º—ñ–Ω–∏ –º–æ–∂—É—Ç—å –∑–º—ñ–Ω—é–≤–∞—Ç–∏ (–ø–æ–ª—ñ—Ç–∏–∫–∏ INSERT/UPDATE/DELETE –Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω—ñ = –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ)
```

#### 12. **custom_strains**

```sql
ALTER TABLE public.custom_strains ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users manage their own"
ON public.custom_strains
FOR ALL
USING (auth.uid() = user_id)
WITH CHECK (auth.uid() = user_id);
```

#### 13. **articles** (–ü—É–±–ª—ñ—á–Ω–∞ —Ç–∞–±–ª–∏—Ü—è)

```sql
ALTER TABLE public.articles ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Public can read articles"
ON public.articles
FOR SELECT
USING (true);
```

#### 14. **notifications**

```sql
ALTER TABLE public.notifications ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view their own notifications"
ON public.notifications
FOR SELECT
USING (auth.uid() = user_id);

CREATE POLICY "Users can insert their own notifications"
ON public.notifications
FOR INSERT
WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update their own notifications"
ON public.notifications
FOR UPDATE
USING (auth.uid() = user_id);

CREATE POLICY "Users can delete their own notifications"
ON public.notifications
FOR DELETE
USING (auth.uid() = user_id);
```

#### 15. **notification_settings**

```sql
ALTER TABLE public.notification_settings ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can manage own notification settings"
ON public.notification_settings
FOR ALL
USING (auth.uid() = user_id);
```

#### 16. **pending_devices**

```sql
ALTER TABLE public.pending_devices ENABLE ROW LEVEL SECURITY;

-- –ë–µ–∑ –ø–æ–ª—ñ—Ç–∏–∫ = —Ç—ñ–ª—å–∫–∏ service role –º–∞—î –¥–æ—Å—Ç—É–ø
```

#### 17. **device_pairing_temp**

```sql
ALTER TABLE public.device_pairing_temp ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Service role can read all pairing codes"
ON public.device_pairing_temp
FOR SELECT
USING (true);  -- Service role bypasses RLS anyway

CREATE POLICY "Users can insert their own pairing codes"
ON public.device_pairing_temp
FOR INSERT
WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Allow cleanup of old pairing codes"
ON public.device_pairing_temp
FOR DELETE
USING (created_at < now() - interval '1 hour');
```

---

## üîß DATABASE FUNCTIONS

### 1. **get_my_role()** ‚≠ê –ö–†–ò–¢–ò–ß–ù–ê

```sql
CREATE OR REPLACE FUNCTION public.get_my_role()
RETURNS app_role
LANGUAGE sql
STABLE
AS $$
  SELECT app_role 
  FROM public.user_roles 
  WHERE user_id = auth.uid()
  LIMIT 1;
$$;

-- –í–ê–ñ–õ–ò–í–û: –ù–ï SECURITY DEFINER (—â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ —Ä–µ–∫—É—Ä—Å—ñ—ó –∑ RLS)
-- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¢–Ü–õ–¨–ö–ò —É useAuth.tsx
```

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –ü–æ–≤–µ—Ä—Ç–∞—î —Ä–æ–ª—å –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –¥–æ–¥–∞—Ç–∫—É.

### 2. **is_admin()** ‚≠ê –ö–†–ò–¢–ò–ß–ù–ê

```sql
CREATE OR REPLACE FUNCTION public.is_admin()
RETURNS BOOLEAN
LANGUAGE sql
STABLE
SECURITY DEFINER
SET search_path = public
AS $$
  SELECT EXISTS (
    SELECT 1 
    FROM public.user_roles
    WHERE user_id = auth.uid()
    AND app_role IN ('admin', 'superadmin', 'developer')
  );
$$;

GRANT EXECUTE ON FUNCTION public.is_admin() TO authenticated;
GRANT EXECUTE ON FUNCTION public.is_admin() TO anon;
```

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –ü–µ—Ä–µ–≤—ñ—Ä—è—î —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —î –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º (admin/superadmin/developer). –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¢–Ü–õ–¨–ö–ò —É RLS –ø–æ–ª—ñ—Ç–∏–∫–∞—Ö.

### 3. **admin_get_all_users()** ‚≠ê –ê–î–ú–Ü–ù-–§–£–ù–ö–¶–Ü–Ø

```sql
CREATE OR REPLACE FUNCTION public.admin_get_all_users()
RETURNS TABLE(
  user_id UUID,
  email TEXT,
  app_role app_role,
  full_name TEXT
)
LANGUAGE sql
SECURITY DEFINER
SET search_path = public
AS $$
  SELECT
    p.user_id,
    p.email,
    COALESCE(ur.app_role, 'user'::app_role) AS app_role,
    p.full_name
  FROM public.profiles p
  LEFT JOIN public.user_roles ur ON p.user_id = ur.user_id
  WHERE public.is_admin();  -- –í–Ω—É—Ç—Ä—ñ—à–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∞–≤
$$;

GRANT EXECUTE ON FUNCTION public.admin_get_all_users() TO authenticated;
```

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –ü–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ –í–°–Ü–• –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (—Ç—ñ–ª—å–∫–∏ –¥–ª—è –∞–¥–º—ñ–Ω—ñ–≤). –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —É `UserManager.tsx`.

### 4. **has_role()** - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–ª—ñ (2 –≤–µ—Ä—Å—ñ—ó)

```sql
-- –í–µ—Ä—Å—ñ—è 1: TEXT –ø–∞—Ä–∞–º–µ—Ç—Ä
CREATE OR REPLACE FUNCTION public.has_role(_user UUID, _role TEXT)
RETURNS BOOLEAN
LANGUAGE sql
STABLE
SECURITY DEFINER
AS $$
  SELECT EXISTS (
    SELECT 1 FROM public.user_roles ur
    WHERE ur.user_id = _user AND ur.app_role = _role::app_role
  );
$$;

-- –í–µ—Ä—Å—ñ—è 2: ENUM –ø–∞—Ä–∞–º–µ—Ç—Ä
CREATE OR REPLACE FUNCTION public.has_role(_user_id UUID, _role app_role)
RETURNS BOOLEAN
LANGUAGE sql
STABLE
SECURITY DEFINER
SET search_path = public
AS $$
  SELECT EXISTS (
    SELECT 1
    FROM public.user_roles
    WHERE user_id = _user_id
      AND app_role = _role
  );
$$;
```

### 5. **handle_new_user()** - –¢—Ä–∏–≥–µ—Ä –ø—Ä–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó

```sql
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER
LANGUAGE plpgsql
SECURITY DEFINER
SET search_path = public
AS $$
BEGIN
  -- ‚≠ê –ö–†–ò–¢–ò–ß–ù–ò–ô –§–Ü–ö–°: –û–±—Ö—ñ–¥ RLS
  SET LOCAL role 'postgres';

  -- –°—Ç–≤–æ—Ä—é—î–º–æ –ø—Ä–æ—Ñ—ñ–ª—å
  INSERT INTO public.profiles (user_id, email)
  VALUES (NEW.id, NEW.email)
  ON CONFLICT (user_id) DO NOTHING;
  
  -- –ü—Ä–∏–∑–Ω–∞—á–∞—î–º–æ —Ä–æ–ª—å 'user' –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
  INSERT INTO public.user_roles (user_id, app_role)
  VALUES (NEW.id, 'user'::app_role)
  ON CONFLICT (user_id) DO NOTHING;
  
  RETURN NEW;
END;
$$;

-- –¢—Ä–∏–≥–µ—Ä –Ω–∞ auth.users
CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW
  EXECUTE FUNCTION public.handle_new_user();
```

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û**: `SET LOCAL role 'postgres'` –æ–±—Ö–æ–¥–∏—Ç—å RLS, —â–æ–± —Ñ—É–Ω–∫—Ü—ñ—è –º–æ–≥–ª–∞ –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –≤ —Ç–∞–±–ª–∏—Ü—ñ.

### 6. **secure_register_device()** - –ë–µ–∑–ø–µ—á–Ω–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –ø—Ä–∏—Å—Ç—Ä–æ—é

```sql
CREATE OR REPLACE FUNCTION public.secure_register_device(
  p_device_id TEXT,
  p_name TEXT,
  p_type TEXT,
  p_location TEXT DEFAULT NULL
)
RETURNS TABLE(
  id UUID,
  device_id TEXT,
  name TEXT,
  type TEXT,
  user_id UUID
)
LANGUAGE plpgsql
SECURITY DEFINER
SET search_path = public
AS $$
BEGIN
  RETURN QUERY
  INSERT INTO public.devices (user_id, device_id, name, type, location, status)
  VALUES (auth.uid(), p_device_id, p_name, p_type, p_location, 'offline')
  RETURNING devices.id, devices.device_id, devices.name, devices.type, devices.user_id;
END;
$$;
```

### 7. **update_updated_at_column()** - –¢—Ä–∏–≥–µ—Ä –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —á–∞—Å—É

```sql
CREATE OR REPLACE FUNCTION public.update_updated_at_column()
RETURNS TRIGGER
LANGUAGE plpgsql
SET search_path = public
AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$;

-- –ó–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è –¥–æ –≤—Å—ñ—Ö —Ç–∞–±–ª–∏—Ü—å –∑ updated_at
CREATE TRIGGER update_profiles_updated_at
  BEFORE UPDATE ON public.profiles
  FOR EACH ROW
  EXECUTE FUNCTION public.update_updated_at_column();

CREATE TRIGGER update_devices_updated_at
  BEFORE UPDATE ON public.devices
  FOR EACH ROW
  EXECUTE FUNCTION public.update_updated_at_column();

-- –Ü —Ç.–¥. –¥–ª—è —ñ–Ω—à–∏—Ö —Ç–∞–±–ª–∏—Ü—å
```

### 8. **update_device_on_new_log()** - –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –ø—Ä–∏ –Ω–æ–≤–æ–º—É –ª–æ–∑—ñ

```sql
CREATE OR REPLACE FUNCTION public.update_device_on_new_log()
RETURNS TRIGGER
LANGUAGE plpgsql
AS $$
BEGIN
  UPDATE public.devices
  SET 
    last_seen_at = now(),
    status = 'online',
    updated_at = now()
  WHERE device_id = NEW.device_id;

  -- –û–Ω–æ–≤–ª—é—î–º–æ last_temp —Ç–∞ last_hum
  IF NEW.metric = 'temperature' THEN
    UPDATE public.devices SET last_temp = NEW.value WHERE device_id = NEW.device_id;
  ELSIF NEW.metric = 'humidity' THEN
    UPDATE public.devices SET last_hum = NEW.value WHERE device_id = NEW.device_id;
  END IF;

  RETURN NEW;
END;
$$;

CREATE TRIGGER device_logs_update_device
  AFTER INSERT ON public.device_logs
  FOR EACH ROW
  EXECUTE FUNCTION public.update_device_on_new_log();
```

### 9. **mark_devices_offline()** - –ü–æ–∑–Ω–∞—á–∞—î –ø—Ä–∏—Å—Ç—Ä–æ—ó –æ—Ñ–ª–∞–π–Ω

```sql
CREATE OR REPLACE FUNCTION public.mark_devices_offline()
RETURNS VOID
LANGUAGE sql
AS $$
  UPDATE public.devices
  SET status = 'offline'
  WHERE status = 'online'
    AND last_activity < now() - interval '2 minutes';
$$;

-- –í–∏–∫–ª–∏–∫–∞—Ç–∏ —á–µ—Ä–µ–∑ pg_cron –∞–±–æ Edge Function –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
```

### 10. **cleanup_old_pairing_records()** - –û—á–∏—â–µ–Ω–Ω—è —Å—Ç–∞—Ä–∏—Ö –∫–æ–¥—ñ–≤

```sql
CREATE OR REPLACE FUNCTION public.cleanup_old_pairing_records()
RETURNS VOID
LANGUAGE plpgsql
SECURITY DEFINER
SET search_path = public
AS $$
BEGIN
  DELETE FROM public.device_pairing_temp
  WHERE created_at < (now() - interval '1 hour');
END;
$$;
```

### 11. **verify_and_consume_pending_token()** - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–æ–∫–µ–Ω—É –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

```sql
CREATE OR REPLACE FUNCTION public.verify_and_consume_pending_token(p_token TEXT)
RETURNS TABLE(
  user_id UUID,
  device_id TEXT
)
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
DECLARE
  v_user UUID;
BEGIN
  SELECT user_id INTO v_user 
  FROM public.pending_devices 
  WHERE device_token = p_token 
    AND expires_at > now();
    
  IF NOT FOUND THEN
    RETURN;
  END IF;

  -- –ü—Ä–∏—Å—Ç—Ä—ñ–π –Ω–∞–¥—Å–∏–ª–∞—î —Å–≤—ñ–π device_id —É payload
  RETURN QUERY SELECT v_user, NULL::TEXT;
END;
$$;
```

---

## üé£ DATABASE TRIGGERS

### 1. –¢—Ä–∏–≥–µ—Ä –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

```sql
CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW
  EXECUTE FUNCTION public.handle_new_user();
```

### 2. –¢—Ä–∏–≥–µ—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è updated_at

```sql
-- –î–ª—è profiles
CREATE TRIGGER update_profiles_updated_at
  BEFORE UPDATE ON public.profiles
  FOR EACH ROW
  EXECUTE FUNCTION public.update_updated_at_column();

-- –î–ª—è devices
CREATE TRIGGER update_devices_updated_at
  BEFORE UPDATE ON public.devices
  FOR EACH ROW
  EXECUTE FUNCTION public.update_updated_at_column();

-- –î–ª—è device_controls
CREATE TRIGGER update_device_controls_updated_at
  BEFORE UPDATE ON public.device_controls
  FOR EACH ROW
  EXECUTE FUNCTION public.update_updated_at_column();

-- –î–ª—è –≤—Å—ñ—Ö —ñ–Ω—à–∏—Ö —Ç–∞–±–ª–∏—Ü—å –∑ updated_at...
```

### 3. –¢—Ä–∏–≥–µ—Ä –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –ø—Ä–∏—Å—Ç—Ä–æ—é –ø—Ä–∏ –Ω–æ–≤–æ–º—É –ª–æ–∑—ñ

```sql
CREATE TRIGGER device_logs_update_device
  AFTER INSERT ON public.device_logs
  FOR EACH ROW
  EXECUTE FUNCTION public.update_device_on_new_log();
```

### 4. –¢—Ä–∏–≥–µ—Ä –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –ø—Ä–∏—Å—Ç—Ä–æ—é

```sql
CREATE OR REPLACE FUNCTION public.update_device_activity()
RETURNS TRIGGER
LANGUAGE plpgsql
AS $$
BEGIN
  UPDATE public.devices
  SET 
    last_activity = now(),
    status = 'online'
  WHERE id::text = NEW.device_id;

  RETURN NEW;
END;
$$;

CREATE TRIGGER update_device_activity_trigger
  AFTER INSERT ON public.sensor_data
  FOR EACH ROW
  EXECUTE FUNCTION public.update_device_activity();
```

---

## ‚ö° EDGE FUNCTIONS

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Edge Functions

```
supabase/
‚îú‚îÄ‚îÄ config.toml                 # ‚≠ê –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îî‚îÄ‚îÄ functions/
    ‚îú‚îÄ‚îÄ device-api/             # API –¥–ª—è ESP –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
    ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
    ‚îú‚îÄ‚îÄ generate-qr/            # –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è QR –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
    ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
    ‚îú‚îÄ‚îÄ notification-system/    # –°–∏—Å—Ç–µ–º–∞ —Å–ø–æ–≤—ñ—â–µ–Ω—å
    ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
    ‚îú‚îÄ‚îÄ setup/                  # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏
    ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
    ‚îî‚îÄ‚îÄ confirm-device/         # –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
        ‚îú‚îÄ‚îÄ index.ts
        ‚îú‚îÄ‚îÄ README.md
        ‚îî‚îÄ‚îÄ LICENSE
```

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è (supabase/config.toml)

```toml
project_id = "ychnmaaximnoxvwnzrgs"

[functions.device-api]
verify_jwt = false  # –ü—É–±–ª—ñ—á–Ω–∏–π endpoint –¥–ª—è ESP

[functions.generate-qr]
verify_jwt = true

[functions.notification-system]
verify_jwt = true

[functions.setup]
verify_jwt = true

[functions.confirm-device]
verify_jwt = true
```

### 1. device-api (ESP API)

**–§–∞–π–ª**: `supabase/functions/device-api/index.ts`

```typescript
import { serve } from "https://deno.land/std@0.168.0/http/server.ts";
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',
};

serve(async (req) => {
  if (req.method === 'OPTIONS') {
    return new Response(null, { headers: corsHeaders });
  }

  try {
    const supabase = createClient(
      Deno.env.get('SUPABASE_URL') ?? '',
      Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') ?? ''
    );

    const { device_id, temp, hum, soil_moisture, light_level } = await req.json();

    // –í—Å—Ç–∞–≤–∫–∞ –ª–æ–≥—É
    const { error: logError } = await supabase
      .from('device_logs')
      .insert({
        device_id,
        temp,
        hum,
        soil_moisture,
        light_level,
        metric: 'env'
      });

    if (logError) throw logError;

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –ø—Ä–∏—Å—Ç—Ä–æ—é
    const { error: deviceError } = await supabase
      .from('devices')
      .update({
        status: 'online',
        last_seen_at: new Date().toISOString(),
        last_temp: temp,
        last_hum: hum
      })
      .eq('device_id', device_id);

    if (deviceError) throw deviceError;

    // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥ –¥–ª—è –ø—Ä–∏—Å—Ç—Ä–æ—é
    const { data: controls } = await supabase
      .from('device_controls')
      .select('control_name, value, intensity')
      .eq('device_id', device_id);

    return new Response(
      JSON.stringify({ success: true, controls }),
      { headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    );

  } catch (error) {
    return new Response(
      JSON.stringify({ error: error.message }),
      { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    );
  }
});
```

### 2. generate-qr (–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è QR)

**–§–∞–π–ª**: `supabase/functions/generate-qr/index.ts`

```typescript
import { serve } from "https://deno.land/std@0.168.0/http/server.ts";
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',
};

serve(async (req) => {
  if (req.method === 'OPTIONS') {
    return new Response(null, { headers: corsHeaders });
  }

  try {
    const authHeader = req.headers.get('Authorization');
    if (!authHeader) throw new Error('No authorization header');

    const supabase = createClient(
      Deno.env.get('SUPABASE_URL') ?? '',
      Deno.env.get('SUPABASE_ANON_KEY') ?? '',
      { global: { headers: { Authorization: authHeader } } }
    );

    const { data: { user } } = await supabase.auth.getUser();
    if (!user) throw new Error('User not authenticated');

    // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —É–Ω—ñ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω—É
    const token = crypto.randomUUID();
    const expiresAt = new Date(Date.now() + 15 * 60 * 1000); // 15 —Ö–≤–∏–ª–∏–Ω

    // –í—Å—Ç–∞–≤–∫–∞ —Ç–æ–∫–µ–Ω—É
    const { error } = await supabase
      .from('pending_devices')
      .insert({
        device_token: token,
        user_id: user.id,
        expires_at: expiresAt.toISOString()
      });

    if (error) throw error;

    // –§–æ—Ä–º—É–≤–∞–Ω–Ω—è QR –¥–∞–Ω–∏—Ö
    const qrData = {
      token,
      supabase_url: Deno.env.get('SUPABASE_URL'),
      supabase_anon_key: Deno.env.get('SUPABASE_ANON_KEY')
    };

    return new Response(
      JSON.stringify({ 
        success: true, 
        token,
        qr_data: JSON.stringify(qrData),
        expires_at: expiresAt
      }),
      { headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    );

  } catch (error) {
    return new Response(
      JSON.stringify({ error: error.message }),
      { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    );
  }
});
```

### 3. notification-system (–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è)

**–§–∞–π–ª**: `supabase/functions/notification-system/index.ts`

```typescript
import { serve } from "https://deno.land/std@0.168.0/http/server.ts";
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',
};

serve(async (req) => {
  if (req.method === 'OPTIONS') {
    return new Response(null, { headers: corsHeaders });
  }

  try {
    const supabase = createClient(
      Deno.env.get('SUPABASE_URL') ?? '',
      Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') ?? ''
    );

    // –õ–æ–≥—ñ–∫–∞ —Å–ø–æ–≤—ñ—â–µ–Ω—å –ø—Ä–æ –∫—Ä–∏—Ç–∏—á–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏/–≤–æ–ª–æ–≥–æ—Å—Ç—ñ
    const { data: devices } = await supabase
      .from('devices')
      .select('*, notification_settings(*)')
      .eq('status', 'online');

    const notifications = [];

    for (const device of devices || []) {
      const settings = device.notification_settings;
      if (!settings) continue;

      if (device.last_temp > settings.temperature_max) {
        notifications.push({
          user_id: device.user_id,
          device_id: device.id,
          type: 'temperature_high',
          message: `Temperature too high: ${device.last_temp}¬∞C`
        });
      }

      // –Ü–Ω—à—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏...
    }

    // –í—ñ–¥–ø—Ä–∞–≤–∫–∞ —Å–ø–æ–≤—ñ—â–µ–Ω—å (email, push, —Ç–æ—â–æ)
    // TODO: –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ email —Å–µ—Ä–≤—ñ—Å–æ–º

    return new Response(
      JSON.stringify({ success: true, notifications_sent: notifications.length }),
      { headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    );

  } catch (error) {
    return new Response(
      JSON.stringify({ error: error.message }),
      { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    );
  }
});
```

### 4. setup (–ü–æ—á–∞—Ç–∫–æ–≤–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è)

**–§–∞–π–ª**: `supabase/functions/setup/index.ts`

```typescript
import { serve } from "https://deno.land/std@0.168.0/http/server.ts";
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',
};

serve(async (req) => {
  if (req.method === 'OPTIONS') {
    return new Response(null, { headers: corsHeaders });
  }

  try {
    const authHeader = req.headers.get('Authorization');
    if (!authHeader) throw new Error('No authorization header');

    const supabase = createClient(
      Deno.env.get('SUPABASE_URL') ?? '',
      Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') ?? '',
      { global: { headers: { Authorization: authHeader } } }
    );

    const { data: { user } } = await supabase.auth.getUser();
    if (!user) throw new Error('User not authenticated');

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–¥–º—ñ–Ω
    const { data: role } = await supabase.rpc('get_my_role');
    if (role !== 'admin' && role !== 'superadmin') {
      throw new Error('Unauthorized');
    }

    const { action } = await req.json();

    let result;

    switch (action) {
      case 'create_default_strains':
        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–µ—Ñ–æ–ª—Ç–Ω–∏—Ö —Å–æ—Ä—Ç—ñ–≤
        result = await createDefaultStrains(supabase);
        break;
      case 'create_default_articles':
        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–µ—Ñ–æ–ª—Ç–Ω–∏—Ö —Å—Ç–∞—Ç–µ–π
        result = await createDefaultArticles(supabase);
        break;
      default:
        throw new Error('Unknown action');
    }

    return new Response(
      JSON.stringify({ success: true, result }),
      { headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    );

  } catch (error) {
    return new Response(
      JSON.stringify({ error: error.message }),
      { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    );
  }
});

async function createDefaultStrains(supabase: any) {
  const defaultStrains = [
    {
      name: 'Northern Lights',
      type: 'photoperiod',
      description: 'Classic indica strain...'
    },
    // –Ü–Ω—à—ñ —Å–æ—Ä—Ç–∏...
  ];

  const { data, error } = await supabase
    .from('strains')
    .insert(defaultStrains);

  if (error) throw error;
  return data;
}

async function createDefaultArticles(supabase: any) {
  // –ê–Ω–∞–ª–æ–≥—ñ—á–Ω–æ –¥–ª—è —Å—Ç–∞—Ç–µ–π
  return [];
}
```

### 5. confirm-device (–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—é)

**–§–∞–π–ª**: `supabase/functions/confirm-device/index.ts`

```typescript
import { serve } from "https://deno.land/std@0.168.0/http/server.ts";
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',
};

serve(async (req) => {
  if (req.method === 'OPTIONS') {
    return new Response(null, { headers: corsHeaders });
  }

  try {
    const { token, device_id, device_name } = await req.json();

    const supabase = createClient(
      Deno.env.get('SUPABASE_URL') ?? '',
      Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') ?? ''
    );

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–æ–∫–µ–Ω—É
    const { data: pending, error: pendingError } = await supabase
      .from('pending_devices')
      .select('*')
      .eq('device_token', token)
      .gt('expires_at', new Date().toISOString())
      .single();

    if (pendingError || !pending) {
      throw new Error('Invalid or expired token');
    }

    // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—é
    const { data: device, error: deviceError } = await supabase
      .from('devices')
      .insert({
        user_id: pending.user_id,
        device_id,
        name: device_name || 'New Device',
        type: 'grow_box',
        status: 'offline'
      })
      .select()
      .single();

    if (deviceError) throw deviceError;

    // –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—É
    await supabase
      .from('pending_devices')
      .delete()
      .eq('device_token', token);

    return new Response(
      JSON.stringify({ success: true, device }),
      { headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    );

  } catch (error) {
    return new Response(
      JSON.stringify({ error: error.message }),
      { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    );
  }
});
```

---

## üé® FRONTEND –ê–†–•–Ü–¢–ï–ö–¢–£–†–ê

### Supabase Client Configuration

**–§–∞–π–ª**: `src/integrations/supabase/client.ts`

```typescript
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

const SUPABASE_URL = "https://ychnmaaximnoxvwnzrgs.supabase.co";
const SUPABASE_PUBLISHABLE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InljaG5tYWF4aW1ub3h2d256cmdzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1NDAyOTQsImV4cCI6MjA3NDExNjI5NH0.JBlfMFXVsuZ_-HqSz-Fl1OTMtdX5vY2GRd8BdHfJaD0";

export const supabase = createClient<Database>(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, {
  auth: {
    storage: localStorage,
    persistSession: true,
    autoRefreshToken: true,
  }
});
```

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û**: –ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `import.meta.env.VITE_*` –∑–º—ñ–Ω–Ω—ñ - Lovable —ó—Ö –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î!

### –†—É—á–Ω—ñ –¢–∏–ø–∏ (Override)

**–§–∞–π–ª**: `src/types/supabase-v2.8.ts`

```typescript
export type Json =
  | string
  | number
  | boolean
  | null
  | { [key: string]: Json | undefined }
  | Json[];

// ENUM —Ç–∏–ø–∏
export type AppRole = "user" | "admin" | "superadmin" | "developer";

// RPC —Ç–∏–ø–∏
export type AdminUser = {
  user_id: string;
  email: string;
  app_role: AppRole;
  full_name: string | null;
};

export interface RpcFunctionDefinitions {
  get_my_role: {
    Args: Record<string, never>;
    Returns: AppRole;
  };
  admin_get_all_users: {
    Args: Record<string, never>;
    Returns: AdminUser[];
  };
  is_admin: {
    Args: Record<string, never>;
    Returns: boolean;
  };
}
```

---

## ü™ù –ö–õ–Æ–ß–û–í–Ü –ö–û–ú–ü–û–ù–ï–ù–¢–ò

### 1. useAuth.tsx ‚≠ê –ö–†–ò–¢–ò–ß–ù–ò–ô

**–§–∞–π–ª**: `src/hooks/useAuth.tsx`

```typescript
import { createContext, useContext, useEffect, useState, ReactNode } from 'react';
import { User, Session } from '@supabase/supabase-js';
import { supabase } from '@/integrations/supabase/client';
import { AppRole } from '@/types/supabase-v2.8';

interface Profile {
  id: string;
  user_id: string;
  email: string;
  full_name?: string;
  avatar_url?: string;
  category?: string;
}

interface AuthContextType {
  user: User | null;
  session: Session | null;
  profile: Profile | null;
  role: AppRole;
  loading: boolean;
  signIn: (email: string, password: string) => Promise<{ error: any }>;
  signUp: (email: string, password: string, fullName?: string) => Promise<{ error: any }>;
  signInWithGoogle: () => Promise<{ error: any }>;
  signInWithGitHub: () => Promise<{ error: any }>;
  signOut: () => Promise<void>;
  refreshProfile: () => Promise<void>;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [session, setSession] = useState<Session | null>(null);
  const [profile, setProfile] = useState<Profile | null>(null);
  const [role, setRole] = useState<AppRole>('user');
  const [loading, setLoading] = useState(true);

  const loadProfileAndRole = async (userId: string) => {
    try {
      // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é
      const { data: profileData, error: profileError } = await supabase
        .from('profiles')
        .select('*')
        .eq('user_id', userId)
        .maybeSingle();

      if (profileError && profileError.code !== 'PGRST116') {
        console.error('Error loading profile:', profileError);
      }

      if (profileData) {
        setProfile(profileData as Profile);
      }

      // ‚≠ê –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–æ–ª—ñ (–≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –û–î–ò–ù –†–ê–ó)
      const { data: roleData, error: roleError } = await (supabase.rpc as any)('get_my_role');

      if (roleError) {
        console.error('Error loading role:', roleError);
        setRole('user');
      } else {
        setRole((roleData as AppRole) || 'user');
      }
    } catch (error) {
      console.error('Error in loadProfileAndRole:', error);
      setRole('user');
    }
  };

  const refreshProfile = async () => {
    if (user) {
      await loadProfileAndRole(user.id);
    }
  };

  useEffect(() => {
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å–µ—Å—ñ—ó
    supabase.auth.getSession().then(({ data: { session } }) => {
      setSession(session);
      setUser(session?.user ?? null);
      if (session?.user) {
        loadProfileAndRole(session.user.id).finally(() => setLoading(false));
      } else {
        setLoading(false);
      }
    });

    // –ü—ñ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∑–º—ñ–Ω–∏ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      async (event, session) => {
        console.log('Auth state changed:', event);
        setSession(session);
        setUser(session?.user ?? null);

        if (session?.user) {
          await loadProfileAndRole(session.user.id);
        } else {
          setProfile(null);
          setRole('user');
        }
        setLoading(false);
      }
    );

    return () => subscription.unsubscribe();
  }, []);

  const signIn = async (email: string, password: string) => {
    const { error } = await supabase.auth.signInWithPassword({ email, password });
    return { error };
  };

  const signUp = async (email: string, password: string, fullName?: string) => {
    const { error } = await supabase.auth.signUp({
      email,
      password,
      options: {
        data: { full_name: fullName },
        emailRedirectTo: `${window.location.origin}/auth/callback`
      }
    });
    return { error };
  };

  const signInWithGoogle = async () => {
    const { error } = await supabase.auth.signInWithOAuth({
      provider: 'google',
      options: {
        redirectTo: `${window.location.origin}/auth/callback`
      }
    });
    return { error };
  };

  const signInWithGitHub = async () => {
    const { error } = await supabase.auth.signInWithOAuth({
      provider: 'github',
      options: {
        redirectTo: `${window.location.origin}/auth/callback`
      }
    });
    return { error };
  };

  const signOut = async () => {
    await supabase.auth.signOut();
    setProfile(null);
    setRole('user');
  };

  return (
    <AuthContext.Provider
      value={{
        user,
        session,
        profile,
        role,
        loading,
        signIn,
        signUp,
        signInWithGoogle,
        signInWithGitHub,
        signOut,
        refreshProfile
      }}
    >
      {children}
    </AuthContext.Provider>
  );
}

export function useAuth() {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
}
```

**–ö–ª—é—á–æ–≤—ñ –º–æ–º–µ–Ω—Ç–∏**:
- `get_my_role()` –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –û–î–ò–ù –†–ê–ó –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `.maybeSingle()` –¥–ª—è –ø—Ä–æ—Ñ—ñ–ª—é
- –ü—ñ–¥–ø–∏—Å–∫–∞ –Ω–∞ `onAuthStateChange` –¥–ª—è real-time –æ–Ω–æ–≤–ª–µ–Ω—å

### 2. useUserRole.tsx

**–§–∞–π–ª**: `src/hooks/useUserRole.tsx`

```typescript
import { useQuery } from '@tanstack/react-query';
import { supabase } from '@/integrations/supabase/client';
import { useAuth } from './useAuth';

export type AppRole = 'user' | 'admin' | 'developer' | 'superadmin';

export function useUserRole() {
  const { user } = useAuth();

  const { data: roles, isLoading, error } = useQuery({
    queryKey: ['user-roles', user?.id],
    queryFn: async () => {
      if (!user) return [];
      
      const { data, error } = await supabase
        .from('user_roles')
        .select('app_role')
        .eq('user_id', user.id) as any;

      if (error) throw error;
      return (data as any[]).map((r: any) => r.app_role as AppRole);
    },
    enabled: !!user,
  });

  const hasRole = (role: AppRole): boolean => {
    return roles?.includes(role) ?? false;
  };

  const isAdmin = hasRole('admin') || hasRole('superadmin');
  const isDeveloper = hasRole('developer');
  const isSuperadmin = hasRole('superadmin');
  const isUser = hasRole('user');

  return {
    roles: roles ?? [],
    hasRole,
    isAdmin,
    isDeveloper,
    isSuperadmin,
    isUser,
    isLoading,
    error,
  };
}
```

### 3. UserManager.tsx (–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å)

**–§–∞–π–ª**: `src/components/admin/UserManager.tsx`

```typescript
import { useEffect, useState } from "react";
import { supabase } from "@/integrations/supabase/client";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { useToast } from "@/hooks/use-toast";
import { Users, Loader2 } from "lucide-react";
import type { AdminUser } from '@/types/supabase-v2.8';

export function UserManager() {
  const [users, setUsers] = useState<AdminUser[]>([]);
  const [loading, setLoading] = useState(true);
  const [updatingId, setUpdatingId] = useState<string | null>(null);
  const { toast } = useToast();

  const loadUsers = async () => {
    try {
      setLoading(true);
      
      // ‚≠ê –í–ò–ö–û–†–ò–°–¢–û–í–£–Ñ–ú–û RPC admin_get_all_users
      const { data, error } = await (supabase.rpc as any)('admin_get_all_users');

      if (error) throw error;
      
      setUsers(data as AdminUser[] || []);
    } catch (error: any) {
      console.error("Error loading users:", error);
      toast({
        title: "–ü–æ–º–∏–ª–∫–∞",
        description: `–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤: ${error.message}`,
        variant: "destructive",
      });
      setUsers([]);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadUsers();
  }, []);

  const handleRoleChange = async (userId: string, newRole: string) => {
    setUpdatingId(userId);
    try {
      // ‚≠ê –í–ò–ö–û–†–ò–°–¢–û–í–£–Ñ–ú–û app_role (–Ω–µ role!)
      const { error } = await supabase
        .from("user_roles")
        .update({ app_role: newRole })
        .eq("user_id", userId);

      if (error) throw error;

      toast({
        title: "–£—Å–ø—ñ—Ö",
        description: `–†–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞ ${newRole}`,
      });

      // –û–Ω–æ–≤–ª—é—î–º–æ –ª–æ–∫–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω
      setUsers((prevUsers) =>
        prevUsers.map((u) =>
          u.user_id === userId ? { ...u, app_role: newRole as AdminUser['app_role'] } : u
        )
      );
    } catch (error: any) {
      console.error("Error updating role:", error);
      toast({
        title: "–ü–æ–º–∏–ª–∫–∞",
        description: "–ù–µ –≤–¥–∞–ª–æ—Å—è –æ–Ω–æ–≤–∏—Ç–∏ —Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞",
        variant: "destructive",
      });
    } finally {
      setUpdatingId(null);
    }
  };

  if (loading) {
    return (
      <Card>
        <CardContent className="p-6 flex items-center justify-center">
          <Loader2 className="h-8 w-8 animate-spin text-primary" />
        </CardContent>
      </Card>
    );
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <Users className="h-5 w-5" />
          –ö–µ—Ä—É–≤–∞–Ω–Ω—è –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏
        </CardTitle>
        <CardDescription>
          –ü–µ—Ä–µ–≥–ª—è–¥ —Ç–∞ –∑–º—ñ–Ω–∞ —Ä–æ–ª–µ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Å–∏—Å—Ç–µ–º–∏
        </CardDescription>
      </CardHeader>
      <CardContent>
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead>–Ü–º'—è</TableHead>
              <TableHead>Email</TableHead>
              <TableHead>–ü–æ—Ç–æ—á–Ω–∞ –†–æ–ª—å</TableHead>
              <TableHead>–ó–º—ñ–Ω–∏—Ç–∏ –†–æ–ª—å</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {users.map((user) => (
              <TableRow key={user.user_id}>
                <TableCell>{user.full_name || "–ù–µ –≤–∫–∞–∑–∞–Ω–æ"}</TableCell>
                <TableCell>{user.email}</TableCell>
                <TableCell>
                  <span className="capitalize">{user.app_role}</span>
                </TableCell>
                <TableCell>
                  <Select
                    value={user.app_role}
                    onValueChange={(value) => handleRoleChange(user.user_id, value)}
                    disabled={updatingId === user.user_id}
                  >
                    <SelectTrigger className="w-[180px]">
                      <SelectValue placeholder="–û–±–µ—Ä—ñ—Ç—å —Ä–æ–ª—å" />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="user">User</SelectItem>
                      <SelectItem value="developer">Developer</SelectItem>
                      <SelectItem value="admin">Admin</SelectItem>
                      <SelectItem value="superadmin">Superadmin</SelectItem>
                    </SelectContent>
                  </Select>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </CardContent>
    </Card>
  );
}

export default UserManager;
```

### 4. Account.tsx

**–§–∞–π–ª**: `src/pages/Account.tsx`

```typescript
import { useAuth } from "@/hooks/useAuth";
import { supabase } from "@/integrations/supabase/client";
import { useEffect, useState } from "react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Label } from "@/components/ui/label";
import { useToast } from "@/hooks/use-toast";

export default function Account() {
  const { user, profile, refreshProfile } = useAuth();
  const [loading, setLoading] = useState(false);
  const [fullName, setFullName] = useState('');
  const { toast } = useToast();

  useEffect(() => {
    if (profile) {
      setFullName(profile.full_name || '');
    }
  }, [profile]);

  const handleUpdateProfile = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      if (!user) throw new Error('No user');

      // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —ñ—Å–Ω—É—î –ø—Ä–æ—Ñ—ñ–ª—å
      const { data: existingProfile, error: fetchError } = await supabase
        .from('profiles')
        .select('*')
        .eq('user_id', user.id)
        .maybeSingle();  // ‚≠ê –í–ò–ö–û–†–ò–°–¢–û–í–£–Ñ–ú–û maybeSingle()

      if (fetchError && fetchError.code !== 'PGRST116') {
        throw fetchError;
      }

      if (existingProfile) {
        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ—Å–Ω—É—é—á–æ–≥–æ –ø—Ä–æ—Ñ—ñ–ª—é
        const { error } = await supabase
          .from('profiles')
          .update({ full_name: fullName })
          .eq('user_id', user.id);

        if (error) throw error;
      } else {
        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ñ—ñ–ª—é
        const { error } = await supabase
          .from('profiles')
          .insert({
            user_id: user.id,
            email: user.email || '',  // ‚≠ê EMAIL –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π!
            full_name: fullName,
          });

        if (error) throw error;
      }

      await refreshProfile();

      toast({
        title: "–£—Å–ø—ñ—Ö",
        description: "–ü—Ä–æ—Ñ—ñ–ª—å –æ–Ω–æ–≤–ª–µ–Ω–æ",
      });
    } catch (error: any) {
      toast({
        title: "–ü–æ–º–∏–ª–∫–∞",
        description: error.message,
        variant: "destructive",
      });
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="container mx-auto p-6">
      <Card>
        <CardHeader>
          <CardTitle>–ú—ñ–π –ê–∫–∞—É–Ω—Ç</CardTitle>
        </CardHeader>
        <CardContent>
          <form onSubmit={handleUpdateProfile} className="space-y-4">
            <div>
              <Label htmlFor="email">Email</Label>
              <Input
                id="email"
                type="email"
                value={user?.email || ''}
                disabled
              />
            </div>
            <div>
              <Label htmlFor="fullName">–ü–æ–≤–Ω–µ —ñ–º'—è</Label>
              <Input
                id="fullName"
                type="text"
                value={fullName}
                onChange={(e) => setFullName(e.target.value)}
              />
            </div>
            <Button type="submit" disabled={loading}>
              {loading ? '–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è...' : '–ó–±–µ—Ä–µ–≥—Ç–∏'}
            </Button>
          </form>
        </CardContent>
      </Card>
    </div>
  );
}
```

### 5. AdminPage.tsx (–ó–∞—Ö–∏—â–µ–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞)

**–§–∞–π–ª**: `src/pages/AdminPage.tsx`

```typescript
import { useAuth } from "@/hooks/useAuth";
import { Navigate } from "react-router-dom";
import { Alert, AlertDescription } from "@/components/ui/alert";
import { AdminPanel } from "@/components/AdminPanel";
import { Loader2 } from "lucide-react";

export default function AdminPage() {
  const { role, loading } = useAuth();

  if (loading) {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center">
        <Loader2 className="h-8 w-8 animate-spin text-primary" />
      </div>
    );
  }

  // ‚≠ê –î–û–°–¢–£–ü –î–õ–Ø ADMIN —Ç–∞ SUPERADMIN
  if (role !== 'admin' && role !== 'superadmin') {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center p-4">
        <Alert variant="destructive" className="max-w-md">
          <AlertDescription>
            –£ –≤–∞—Å –Ω–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ—ó –ø–∞–Ω–µ–ª—ñ.
          </AlertDescription>
        </Alert>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background">
      <AdminPanel />
    </div>
  );
}
```

---

## üé® –î–ò–ó–ê–ô–ù –°–ò–°–¢–ï–ú–ê

### Tailwind Configuration

**–§–∞–π–ª**: `tailwind.config.ts`

```typescript
import type { Config } from "tailwindcss";

export default {
  darkMode: ["class"],
  content: [
    "./pages/**/*.{ts,tsx}",
    "./components/**/*.{ts,tsx}",
    "./app/**/*.{ts,tsx}",
    "./src/**/*.{ts,tsx}",
  ],
  prefix: "",
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      colors: {
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      keyframes: {
        "accordion-down": {
          from: { height: "0" },
          to: { height: "var(--radix-accordion-content-height)" },
        },
        "accordion-up": {
          from: { height: "var(--radix-accordion-content-height)" },
          to: { height: "0" },
        },
      },
      animation: {
        "accordion-down": "accordion-down 0.2s ease-out",
        "accordion-up": "accordion-up 0.2s ease-out",
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
} satisfies Config;
```

### CSS Variables (index.css)

**–§–∞–π–ª**: `src/index.css`

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* ‚≠ê –°–ï–ú–ê–ù–¢–ò–ß–ù–Ü HSL –¢–û–ö–ï–ù–ò */
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;
    --primary: 142 76% 36%;  /* –ó–µ–ª–µ–Ω–∏–π –¥–ª—è grow theme */
    --primary-foreground: 210 40% 98%;
    --secondary: 210 40% 96.1%;
    --secondary-foreground: 222.2 47.4% 11.2%;
    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;
    --accent: 210 40% 96.1%;
    --accent-foreground: 222.2 47.4% 11.2%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 142 76% 36%;
    --radius: 0.5rem;
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --card: 222.2 84% 4.9%;
    --card-foreground: 210 40% 98%;
    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;
    --primary: 142 76% 36%;
    --primary-foreground: 222.2 47.4% 11.2%;
    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;
    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent: 217.2 32.6% 17.5%;
    --accent-foreground: 210 40% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 142 76% 36%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}
```

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û**: –í–°–Ü –∫–æ–ª—å–æ—Ä–∏ –ü–û–í–ò–ù–ù–Ü –±—É—Ç–∏ HSL —Ñ–æ—Ä–º–∞—Ç—É! –ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ RGB –∞–±–æ HEX –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö.

---

## ü§ñ IOT –Ü–ù–¢–ï–ì–†–ê–¶–Ü–Ø (ESP8266/ESP32)

### –ü—Ä–∏–∫–ª–∞–¥ –ü—Ä–æ—à–∏–≤–∫–∏ ESP8266

**–§–∞–π–ª**: `esp8266-firmware.ino` (Arduino)

```cpp
#include <ESP8266WiFi.h>
#include <ESP8266HTTPClient.h>
#include <ArduinoJson.h>
#include <DHT.h>

// WiFi –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
const char* ssid = "YOUR_WIFI_SSID";
const char* password = "YOUR_WIFI_PASSWORD";

// Supabase –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
const char* supabaseUrl = "https://ychnmaaximnoxvwnzrgs.supabase.co";
const char* deviceApiUrl = "https://ychnmaaximnoxvwnzrgs.supabase.co/functions/v1/device-api";

// –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID –ø—Ä–∏—Å—Ç—Ä–æ—é (MAC address)
String deviceId = "";

// –ü—ñ–Ω –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
#define DHT_PIN D4
#define DHT_TYPE DHT22
DHT dht(DHT_PIN, DHT_TYPE);

#define WATER_PUMP_PIN D1
#define LIGHT_PIN D2
#define VENT_PIN D3
#define HEATER_PIN D5

// –°—Ç–∞–Ω –ø—Ä–∏—Å—Ç—Ä–æ—é
struct DeviceState {
  bool waterPump = false;
  bool light = false;
  bool ventilation = false;
  bool heater = false;
  int lightIntensity = 0;
} state;

void setup() {
  Serial.begin(115200);
  delay(10);

  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—ñ–Ω—ñ–≤
  pinMode(WATER_PUMP_PIN, OUTPUT);
  pinMode(LIGHT_PIN, OUTPUT);
  pinMode(VENT_PIN, OUTPUT);
  pinMode(HEATER_PIN, OUTPUT);

  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è DHT
  dht.begin();

  // –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ WiFi
  Serial.println();
  Serial.print("Connecting to ");
  Serial.println(ssid);

  WiFi.begin(ssid, password);

  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }

  Serial.println("");
  Serial.println("WiFi connected");
  Serial.println("IP address: ");
  Serial.println(WiFi.localIP());

  // –û—Ç—Ä–∏–º–∞–Ω–Ω—è MAC address —è–∫ device_id
  deviceId = WiFi.macAddress();
  deviceId.replace(":", "");
  Serial.print("Device ID: ");
  Serial.println(deviceId);
}

void loop() {
  // –ß–∏—Ç–∞–Ω–Ω—è —Å–µ–Ω—Å–æ—Ä—ñ–≤
  float temp = dht.readTemperature();
  float hum = dht.readHumidity();

  if (isnan(temp) || isnan(hum)) {
    Serial.println("Failed to read from DHT sensor!");
    delay(2000);
    return;
  }

  // –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–∏—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä
  sendTelemetry(temp, hum);

  // –ó–∞—Ç—Ä–∏–º–∫–∞ 10 —Å–µ–∫—É–Ω–¥
  delay(10000);
}

void sendTelemetry(float temp, float hum) {
  if (WiFi.status() == WL_CONNECTED) {
    WiFiClient client;
    HTTPClient http;

    http.begin(client, deviceApiUrl);
    http.addHeader("Content-Type", "application/json");

    // –§–æ—Ä–º—É–≤–∞–Ω–Ω—è JSON
    StaticJsonDocument<256> doc;
    doc["device_id"] = deviceId;
    doc["temp"] = temp;
    doc["hum"] = hum;
    doc["soil_moisture"] = analogRead(A0) / 10.23; // 0-100%
    doc["light_level"] = analogRead(A0) / 10.23;   // –ü—Ä–∏–∫–ª–∞–¥

    String requestBody;
    serializeJson(doc, requestBody);

    Serial.print("Sending: ");
    Serial.println(requestBody);

    int httpResponseCode = http.POST(requestBody);

    if (httpResponseCode > 0) {
      String response = http.getString();
      Serial.println(httpResponseCode);
      Serial.println(response);

      // –ü–∞—Ä—Å–∏–Ω–≥ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (–∫–æ–º–∞–Ω–¥–∏ –≤—ñ–¥ —Å–µ—Ä–≤–µ—Ä–∞)
      DynamicJsonDocument responseDoc(1024);
      deserializeJson(responseDoc, response);

      if (responseDoc.containsKey("controls")) {
        JsonArray controls = responseDoc["controls"];
        for (JsonObject control : controls) {
          String name = control["control_name"];
          bool value = control["value"];
          int intensity = control["intensity"] | 0;

          // –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥
          if (name == "water_pump") {
            digitalWrite(WATER_PUMP_PIN, value ? HIGH : LOW);
            state.waterPump = value;
          } else if (name == "light_system") {
            analogWrite(LIGHT_PIN, map(intensity, 0, 100, 0, 1023));
            state.light = value;
            state.lightIntensity = intensity;
          } else if (name == "ventilation") {
            digitalWrite(VENT_PIN, value ? HIGH : LOW);
            state.ventilation = value;
          } else if (name == "heater") {
            digitalWrite(HEATER_PIN, value ? HIGH : LOW);
            state.heater = value;
          }
        }
      }
    } else {
      Serial.print("Error on sending POST: ");
      Serial.println(httpResponseCode);
    }

    http.end();
  } else {
    Serial.println("WiFi Disconnected");
  }
}
```

### MQTT –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–∞ MQTT —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è:

**Topics:**
- `agro-hogwards/{device_id}/telemetry` - –¢–µ–ª–µ–º–µ—Ç—Ä—ñ—è –≤—ñ–¥ –ø—Ä–∏—Å—Ç—Ä–æ—é
- `agro-hogwards/{device_id}/commands` - –ö–æ–º–∞–Ω–¥–∏ –¥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é
- `agro-hogwards/{device_id}/status` - –°—Ç–∞—Ç—É—Å –ø—Ä–∏—Å—Ç—Ä–æ—é

---

## üöÄ –†–û–ó–ì–û–†–¢–ê–ù–ù–Ø

### 1. Environment Variables

**–§–∞–π–ª**: `.env`

```env
# Supabase
VITE_SUPABASE_URL=https://ychnmaaximnoxvwnzrgs.supabase.co
VITE_SUPABASE_ANON_KEY=your_anon_key_here

# ‚ö†Ô∏è –ù–ï –í–ò–ö–û–†–ò–°–¢–û–í–£–í–ê–¢–ò —É –∫–æ–¥—ñ Lovable!
# –ó–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ö–∞—Ä–¥–∫–æ–¥–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ src/integrations/supabase/client.ts
```

### 2. Build Script

**–§–∞–π–ª**: `build-for-hosting.sh`

```bash
#!/bin/bash

echo "üå± Building Agro Hogwards for production..."

# –û—á–∏—Å—Ç–∫–∞
rm -rf dist
rm -f grow-box-technology-website.zip

# Build
npm run build

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞—Ä—Ö—ñ–≤—É
cd dist
zip -r ../grow-box-technology-website.zip .
cd ..

echo "‚úÖ Build complete! Upload grow-box-technology-website.zip to your hosting."
```

### 3. Netlify Configuration

**–§–∞–π–ª**: `netlify.toml`

```toml
[build]
  command = "npm run build"
  publish = "dist"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
```

### 4. Vercel Configuration

**–§–∞–π–ª**: `vercel.json`

```json
{
  "rewrites": [
    { "source": "/(.*)", "destination": "/" }
  ]
}
```

### 5. Docker (–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

**–§–∞–π–ª**: `docker-compose.yml`

```yaml
version: '3.8'

services:
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    ports:
      - "3000:80"
    environment:
      - NODE_ENV=production
```

**–§–∞–π–ª**: `Dockerfile.frontend`

```dockerfile
FROM node:18-alpine AS builder

WORKDIR /app

COPY package*.json ./
RUN npm ci

COPY . .
RUN npm run build

FROM nginx:alpine

COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx/default.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

---

## üìù –Ü–ù–°–¢–†–£–ö–¶–Ü–á –ó –í–Ü–î–¢–í–û–†–ï–ù–ù–Ø

### –ö—Ä–æ–∫ 1: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Supabase –ø—Ä–æ–µ–∫—Ç—É

1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ [supabase.com](https://supabase.com)
2. –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π –ø—Ä–æ–µ–∫—Ç
3. –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ Project URL —Ç–∞ Anon Key

### –ö—Ä–æ–∫ 2: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ë–∞–∑–∏ –î–∞–Ω–∏—Ö

1. –í—ñ–¥–∫—Ä–∏—Ç–∏ SQL Editor —É Supabase Dashboard
2. –í–∏–∫–æ–Ω–∞—Ç–∏ —É—Å—ñ SQL –∫–æ–º–∞–Ω–¥–∏ –∑ —Ä–æ–∑–¥—ñ–ª—É "–ë–∞–∑–∞ –î–∞–Ω–∏—Ö" —Ü—å–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç—É:
   - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è ENUM —Ç–∏–ø—ñ–≤
   - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å
   - –£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è RLS
   - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è RLS –ø–æ–ª—ñ—Ç–∏–∫
   - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–π
   - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä—ñ–≤

### –ö—Ä–æ–∫ 3: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Frontend

1. –ö–ª–æ–Ω—É–≤–∞—Ç–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –∞–±–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π –ø—Ä–æ–µ–∫—Ç:
```bash
npm create vite@latest agro-hogwards -- --template react-ts
cd agro-hogwards
```

2. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ:
```bash
npm install @supabase/supabase-js@2.80.0
npm install @tanstack/react-query@5.83.0
npm install react-router-dom@6.30.1
npm install react-i18next@15.7.3 i18next@25.5.2
npm install recharts@3.2.1
npm install lucide-react@0.462.0
npm install react-hook-form@7.61.1
npm install zod@3.25.76
npm install @hookform/resolvers@3.10.0
npm install sonner@1.7.4
npm install tailwindcss-animate@1.0.7
npm install class-variance-authority@0.7.1
npm install clsx@2.1.1
npm install tailwind-merge@2.6.0

# Shadcn UI (–≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –≤—Ä—É—á–Ω—É –∞–±–æ —á–µ—Ä–µ–∑ CLI)
npx shadcn-ui@latest init
npx shadcn-ui@latest add button card input label select table dialog toast
# ... (–≤—Å—ñ —ñ–Ω—à—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –∑ ui/)
```

3. –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –≤—Å—ñ —Ñ–∞–π–ª–∏ –∑ —Ü—å–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç—É —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –ø–∞–ø–∫–∏

4. –û–Ω–æ–≤–∏—Ç–∏ `src/integrations/supabase/client.ts` –∑ –≤–∞—à–∏–º–∏ credentials:
```typescript
const SUPABASE_URL = "YOUR_PROJECT_URL";
const SUPABASE_PUBLISHABLE_KEY = "YOUR_ANON_KEY";
```

### –ö—Ä–æ–∫ 4: –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è Edge Functions

1. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ Supabase CLI:
```bash
npm install -g supabase
```

2. Login:
```bash
supabase login
```

3. Link –ø—Ä–æ–µ–∫—Ç—É:
```bash
supabase link --project-ref YOUR_PROJECT_ID
```

4. Deploy functions:
```bash
supabase functions deploy device-api
supabase functions deploy generate-qr
supabase functions deploy notification-system
supabase functions deploy setup
supabase functions deploy confirm-device
```

### –ö—Ä–æ–∫ 5: –ó–∞–ø—É—Å–∫ –õ–æ–∫–∞–ª—å–Ω–æ

```bash
npm run dev
```

### –ö—Ä–æ–∫ 6: Build –¥–ª—è Production

```bash
npm run build
```

### –ö—Ä–æ–∫ 7: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ü–µ—Ä—à–æ–≥–æ Superadmin

1. –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —á–µ—Ä–µ–∑ UI
2. –£ Supabase Dashboard –∑–Ω–∞–π—Ç–∏ user_id
3. –í–∏–∫–æ–Ω–∞—Ç–∏ SQL:
```sql
UPDATE public.user_roles
SET app_role = 'superadmin'
WHERE user_id = 'YOUR_USER_ID';
```

---

## ‚úÖ CHECKLIST –í–Ü–î–¢–í–û–†–ï–ù–ù–Ø

- [ ] –°—Ç–≤–æ—Ä–µ–Ω–æ Supabase –ø—Ä–æ–µ–∫—Ç
- [ ] –°—Ç–≤–æ—Ä–µ–Ω–æ –≤—Å—ñ ENUM —Ç–∏–ø–∏
- [ ] –°—Ç–≤–æ—Ä–µ–Ω–æ –≤—Å—ñ —Ç–∞–±–ª–∏—Ü—ñ –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏
- [ ] –£–≤—ñ–º–∫–Ω–µ–Ω–æ RLS –Ω–∞ –≤—Å—ñ—Ö —Ç–∞–±–ª–∏—Ü—è—Ö
- [ ] –°—Ç–≤–æ—Ä–µ–Ω–æ –≤—Å—ñ RLS –ø–æ–ª—ñ—Ç–∏–∫–∏
- [ ] –°—Ç–≤–æ—Ä–µ–Ω–æ –≤—Å—ñ database functions
- [ ] –°—Ç–≤–æ—Ä–µ–Ω–æ –≤—Å—ñ triggers
- [ ] –°—Ç–≤–æ—Ä–µ–Ω–æ –ø–µ—Ä—à–∏–π superadmin –∞–∫–∞—É–Ω—Ç
- [ ] –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ Node.js –ø—Ä–æ–µ–∫—Ç
- [ ] –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤—Å—ñ npm –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
- [ ] –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ –≤—Å—ñ frontend —Ñ–∞–π–ª–∏
- [ ] –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ Supabase client –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ credentials
- [ ] –†–æ–∑–≥–æ—Ä–Ω—É—Ç–æ –≤—Å—ñ Edge Functions
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ –ª–æ–∫–∞–ª—å–Ω–∏–π –∑–∞–ø—É—Å–∫
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ –¥–æ—Å—Ç—É–ø –¥–æ Admin Panel
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è ESP –ø—Ä–∏—Å—Ç—Ä–æ—é (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –ó—Ä–æ–±–ª–µ–Ω–æ production build
- [ ] –†–æ–∑–≥–æ—Ä–Ω—É—Ç–æ –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥

---

## üéì –î–û–î–ê–¢–ö–û–í–Ü –†–ï–°–£–†–°–ò

- **Supabase Docs**: https://supabase.com/docs
- **React Router Docs**: https://reactrouter.com/
- **TanStack Query**: https://tanstack.com/query/latest
- **Shadcn UI**: https://ui.shadcn.com/
- **Tailwind CSS**: https://tailwindcss.com/docs
- **ESP8266 Arduino Core**: https://arduino-esp8266.readthedocs.io/

---

## üìß –ü–Ü–î–¢–†–ò–ú–ö–ê

–î–ª—è –ø–∏—Ç–∞–Ω—å —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏:
- GitHub Issues: [link to repo]
- Email: support@agro-hogwards.com
- Discord: [link to discord]

---

**üéâ –í–Ü–¢–ê–Ñ–ú–û! –í–∏ –º–∞—î—Ç–µ –ø–æ–≤–Ω—É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é –¥–ª—è –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É Agro Hogwards!**

**–í–µ—Ä—Å—ñ—è:** 5.0 ULTIMATE  
**–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:** 2025-11-19  
**–ê–≤—Ç–æ—Ä:** Lovable AI + User

---

## üîë –ö–†–ò–¢–ò–ß–ù–Ü –ú–û–ú–ï–ù–¢–ò (TL;DR)

1. **user_roles.app_role** - –ù–ï `role`!
2. **device_controls.intensity** - –Ü—Å–Ω—É—î!
3. **devices.last_seen_at** - –Ü—Å–Ω—É—î!
4. **is_admin()** - –¢—ñ–ª—å–∫–∏ —É RLS –ø–æ–ª—ñ—Ç–∏–∫–∞—Ö!
5. **get_my_role()** - –¢—ñ–ª—å–∫–∏ —É useAuth.tsx!
6. **admin_get_all_users()** - –¢—ñ–ª—å–∫–∏ —É UserManager.tsx!
7. **RLS SELECT –Ω–∞ user_roles** - –ë–ï–ó is_admin()!
8. **Account.tsx** - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ .maybeSingle()!
9. **ENUM app_role** - 'user', 'developer', 'admin', 'superadmin'
10. **HSL –∫–æ–ª—å–æ—Ä–∏** - –ó–ê–í–ñ–î–ò —É index.css!
11. **Superadmin** - –ü–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ is_admin()
12. **–ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ VITE_*** - –•–∞—Ä–¥–∫–æ–¥ —É client.ts!

---

**–¶–¨–û–ì–û –î–û–ö–£–ú–ï–ù–¢–£ –î–û–°–¢–ê–¢–ù–¨–û –î–õ–Ø –ü–û–í–ù–û–ì–û –í–Ü–î–¢–í–û–†–ï–ù–ù–Ø –ü–†–û–ï–ö–¢–£ –ó –ù–£–õ–Ø! üöÄ**
